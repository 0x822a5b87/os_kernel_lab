# lab00

## 实验目的

- 了解操作系统开发实验环境
- 熟悉命令行方式的编译、调试工程
- 掌握基于硬件模拟器的调试技术
- 熟悉C语言编程和指针的概念
- 了解X86汇编语言

## 了解OS实验

![ucore 系统结构图](../pic/ucore 系统结构图.png)

那我们准备如何一步一步来实现ucore呢？根据一个操作系统的设计实现过程，我们可以有如下的实验步骤：

1. 启动操作系统的 `bootloader`，用于了解操作系统启动前的状态和要做的准备工作，了解运行操作系统的硬件支持，操作系统如何加载到内存中，理解两类中断--“外设中断”，“陷阱中断”等；
2. 物理内存管理子系统，用于理解x86分段/分页模式，了解操作系统如何管理物理内存；
3. 虚拟内存管理子系统，通过页表机制和换入换出（swap）机制，以及中断-“故障中断”、缺页故障处理等，实现基于页的内存替换算法；
4. 内核线程子系统，用于了解如何创建相对与用户进程更加简单的内核态线程，如果对内核线程进行动态管理等；
5. 用户进程管理子系统，用于了解用户态进程创建、执行、切换和结束的动态管理过程，了解在用户态通过系统调用得到内核态的内核服务的过程；
6. 处理器调度子系统，用于理解操作系统的调度过程和调度算法；
7. 同步互斥与进程间通信子系统，了解进程间如何进行信息交换和共享，并了解同步互斥的具体实现以及对系统性能的影响，研究死锁产生的原因，以及如何避免死锁；
8. 文件系统，了解文件系统的具体实现，与进程管理等的关系，了解缓存对操作系统IO访问的性能改进，了解虚拟文件系统（VFS）、buffer cache和disk driver之间的关系。

## 了解编程开发调试的基本工具

### `AT&T` 汇编基本语法

基于 x86 架构 的处理器所使用的汇编指令一般有两种格式 : 

- Intel 汇编
	- DOS(8086处理器), Windows
	- Windows 派系 -> VC 编译器
- AT&T汇编
	- Linux, Unix, Mac OS, iOS(模拟器)
	- Unix派系 -> GCC编译器

![两种汇编语言简要说明](../pic/两种汇编语言简要说明.png)

### 寄存器和汇编的一些总结

e 表示 extend 的意思是扩展到了 32 位

eax/rax		accumulator register 返回值
ebx/rbx		base register 基址寄存器
ecx/rcx		counter register 计数器
edx/rdx		data register 数据寄存器

esi/rsi		source index 源地址指针寄存器
edi/rdi		destination index 目的地址指针寄存器
ebp/rbp		base pointer 基址指针寄存器
esp/rsp		stack pointer 堆栈指针寄存器

## 

https://bbs.csdn.net/topics/392552998
http://www.ruanyifeng.com/blog/2018/01/assembly-language-primer.html

一般函数调用的开始都会执行 `pushq %rbp`

假设我们的代码如下

```cpp
void base();
void invoked();

void base()
{
    invoked();
}
```

在函数开始的时候，有一个基准地址，这个地址就是 invoked(); 这一行代码的地址，这个地址存放在 %rbp 中。

程序执行到 invoked() 函数内部时，首先我们需要将 %rbp 地址存起来，否则我们不知道当 invoked() 函数执行结束时下一步应该执行哪里的代码。

pushq %rbp 等同于以下两条指令

subq	$8, %rsp
moveq	%rbp, %rsp

意思就是，首先将栈指针 -8，这样 %rsp 指向的位置就是我们的被调用函数的栈开始的地址；将 %rbp 压入到函数栈开始的地方，这样当我们退出函数的时候我们就知道跳到哪里执行了
